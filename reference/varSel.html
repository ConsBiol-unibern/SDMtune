<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Variable Selection — varSel • SDMtune</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Variable Selection — varSel"><meta name="description" content="The function performs a data-driven variable selection. Starting from the
provided model it iterates through all the variables starting from the one
with the highest contribution (permutation importance or maxent percent
contribution). If the variable is correlated with other variables (according
to the given method and threshold) it performs a Jackknife test and among the
correlated variables it removes the one that results in the best performing
model when removed (according to the given metric for the training dataset).
The process is repeated until the remaining variables are not highly
correlated anymore."><meta property="og:description" content="The function performs a data-driven variable selection. Starting from the
provided model it iterates through all the variables starting from the one
with the highest contribution (permutation importance or maxent percent
contribution). If the variable is correlated with other variables (according
to the given method and threshold) it performs a Jackknife test and among the
correlated variables it removes the one that results in the best performing
model when removed (according to the given metric for the training dataset).
The process is repeated until the remaining variables are not highly
correlated anymore."><meta property="og:image" content="https://consbiol-unibern.github.io/SDMtune/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SDMtune</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.3.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/articles/prepare-data.html">Prepare data for the analysis</a></li>
    <li><a class="dropdown-item" href="../articles/articles/train-model.html">Train a model</a></li>
    <li><a class="dropdown-item" href="../articles/articles/make-predictions.html">Make predictions</a></li>
    <li><a class="dropdown-item" href="../articles/articles/evaluate-model.html">Evaluate a model</a></li>
    <li><a class="dropdown-item" href="../articles/articles/evaluation-strategies.html">Evaluation strategies</a></li>
    <li><a class="dropdown-item" href="../articles/articles/variable-importance.html">Variable importance</a></li>
    <li><a class="dropdown-item" href="../articles/articles/variable-selection.html">Data-driven variable selection</a></li>
    <li><a class="dropdown-item" href="../articles/articles/tune-hyperparameters.html">Tune model hyperparameters</a></li>
    <li><a class="dropdown-item" href="../articles/articles/train-tune-presence-absence-models.html">Train and tune presence absence models</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/ConsBiol-unibern/SDMtune"><span class="fa fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Variable Selection</h1>
      <small class="dont-index">Source: <a href="https://github.com/ConsBiol-unibern/SDMtune/blob/master/R/varSel.R" class="external-link"><code>R/varSel.R</code></a></small>
      <div class="d-none name"><code>varSel.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The function performs a data-driven variable selection. Starting from the
provided model it iterates through all the variables starting from the one
with the highest contribution (permutation importance or maxent percent
contribution). If the variable is correlated with other variables (according
to the given method and threshold) it performs a Jackknife test and among the
correlated variables it removes the one that results in the best performing
model when removed (according to the given metric for the training dataset).
The process is repeated until the remaining variables are not highly
correlated anymore.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">varSel</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">metric</span>,</span>
<span>  <span class="va">bg4cor</span>,</span>
<span>  test <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  env <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"spearman"</span>,</span>
<span>  cor_th <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  permut <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  use_pc <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  interactive <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p><a href="SDMmodel-class.html">SDMmodel</a> or <a href="SDMmodelCV-class.html">SDMmodelCV</a> object.</p></dd>


<dt id="arg-metric">metric<a class="anchor" aria-label="anchor" href="#arg-metric"></a></dt>
<dd><p>character. The metric used to evaluate the models, possible
values are: "auc", "tss" and "aicc".</p></dd>


<dt id="arg-bg-cor">bg4cor<a class="anchor" aria-label="anchor" href="#arg-bg-cor"></a></dt>
<dd><p><a href="SWD-class.html">SWD</a> object. Background locations used to test the
correlation between environmental variables.</p></dd>


<dt id="arg-test">test<a class="anchor" aria-label="anchor" href="#arg-test"></a></dt>
<dd><p><a href="SWD-class.html">SWD</a>. Test dataset used to evaluate the model, not
used with aicc and <a href="SDMmodelCV-class.html">SDMmodelCV</a> objects.</p></dd>


<dt id="arg-env">env<a class="anchor" aria-label="anchor" href="#arg-env"></a></dt>
<dd><p><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a> containing the environmental variables, used
only with "aicc".</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>character. The method used to compute the correlation matrix.</p></dd>


<dt id="arg-cor-th">cor_th<a class="anchor" aria-label="anchor" href="#arg-cor-th"></a></dt>
<dd><p>numeric. The correlation threshold used to select highly
correlated variables.</p></dd>


<dt id="arg-permut">permut<a class="anchor" aria-label="anchor" href="#arg-permut"></a></dt>
<dd><p>integer. Number of permutations.</p></dd>


<dt id="arg-use-pc">use_pc<a class="anchor" aria-label="anchor" href="#arg-use-pc"></a></dt>
<dd><p>logical, use percent contribution. If <code>TRUE</code> and the model is
trained using the <a href="Maxent-class.html">Maxent</a> method, the algorithm uses the percent
contribution computed by Maxent software to score the variable importance.</p></dd>


<dt id="arg-interactive">interactive<a class="anchor" aria-label="anchor" href="#arg-interactive"></a></dt>
<dd><p>logical. If <code>FALSE</code> the interactive chart is not created.</p></dd>


<dt id="arg-progress">progress<a class="anchor" aria-label="anchor" href="#arg-progress"></a></dt>
<dd><p>logical. If <code>TRUE</code> shows a progress bar.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>logical. If <code>TRUE</code> prints informative messages.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The <a href="SDMmodel-class.html">SDMmodel</a> or <a href="SDMmodelCV-class.html">SDMmodelCV</a> object trained
using the selected variables.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>An interactive chart showing in real-time the steps performed by the
algorithm is displayed in the Viewer pane.</p>
<p>To find highly correlated variables the following formula is used:
$$| coeff | \le cor_th$$</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Sergio Vignali</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Acquire environmental variables</span></span></span>
<span class="r-in"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"dismo"</span><span class="op">)</span>, <span class="st">"ex"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    pattern <span class="op">=</span> <span class="st">"grd"</span>,</span></span>
<span class="r-in"><span>                    full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">predictors</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Prepare presence and background locations</span></span></span>
<span class="r-in"><span><span class="va">p_coords</span> <span class="op">&lt;-</span> <span class="va">virtualSp</span><span class="op">$</span><span class="va">presence</span></span></span>
<span class="r-in"><span><span class="va">bg_coords</span> <span class="op">&lt;-</span> <span class="va">virtualSp</span><span class="op">$</span><span class="va">background</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create SWD object</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="prepareSWD.html">prepareSWD</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">"Virtual species"</span>,</span></span>
<span class="r-in"><span>                   p <span class="op">=</span> <span class="va">p_coords</span>,</span></span>
<span class="r-in"><span>                   a <span class="op">=</span> <span class="va">bg_coords</span>,</span></span>
<span class="r-in"><span>                   env <span class="op">=</span> <span class="va">predictors</span>,</span></span>
<span class="r-in"><span>                   categorical <span class="op">=</span> <span class="st">"biome"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Extracting predictor information for <span style="color: #00BB00;">presence</span> locations</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Extracting predictor information for <span style="color: #00BB00;">presence</span> locations <span style="color: #B2B2B2;">[21ms]</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Extracting predictor information for <span style="color: #00BB00;">absence/background</span> locations</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Extracting predictor information for <span style="color: #00BB00;">absence/background</span> locations <span style="color: #B2B2B2;">[47ms]</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Split presence locations in training (80%) and testing (20%) datasets</span></span></span>
<span class="r-in"><span><span class="va">datasets</span> <span class="op">&lt;-</span> <span class="fu"><a href="trainValTest.html">trainValTest</a></span><span class="op">(</span><span class="va">data</span>,</span></span>
<span class="r-in"><span>                         test <span class="op">=</span> <span class="fl">0.2</span>,</span></span>
<span class="r-in"><span>                         only_presence <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">datasets</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">datasets</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Train a model</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="train.html">train</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"Maxnet"</span>,</span></span>
<span class="r-in"><span>               data <span class="op">=</span> <span class="va">train</span>,</span></span>
<span class="r-in"><span>               fc <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Prepare background locations to test autocorrelation, this usually gives a</span></span></span>
<span class="r-in"><span><span class="co"># warning message given that less than 10000 points can be randomly sampled</span></span></span>
<span class="r-in"><span><span class="va">bg_coords</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/sample.html" class="external-link">spatSample</a></span><span class="op">(</span><span class="va">predictors</span>,</span></span>
<span class="r-in"><span>                               size <span class="op">=</span> <span class="fl">9000</span>,</span></span>
<span class="r-in"><span>                               method <span class="op">=</span> <span class="st">"random"</span>,</span></span>
<span class="r-in"><span>                               na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                               xy <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                               values <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">bg</span> <span class="op">&lt;-</span> <span class="fu"><a href="prepareSWD.html">prepareSWD</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">"Virtual species"</span>,</span></span>
<span class="r-in"><span>                 a <span class="op">=</span> <span class="va">bg_coords</span>,</span></span>
<span class="r-in"><span>                 env <span class="op">=</span> <span class="va">predictors</span>,</span></span>
<span class="r-in"><span>                 categorical <span class="op">=</span> <span class="st">"biome"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Extracting predictor information for <span style="color: #00BB00;">absence/background</span> locations</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Extracting predictor information for <span style="color: #00BB00;">absence/background</span> locations <span style="color: #B2B2B2;">[68ms]</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Remove variables with correlation higher than 0.7 accounting for the AUC,</span></span></span>
<span class="r-in"><span><span class="co"># in the following example the variable importance is computed as permutation</span></span></span>
<span class="r-in"><span><span class="co"># importance</span></span></span>
<span class="r-in"><span><span class="va">vs</span> <span class="op">&lt;-</span> <span class="fu">varSel</span><span class="op">(</span><span class="va">model</span>,</span></span>
<span class="r-in"><span>             metric <span class="op">=</span> <span class="st">"auc"</span>,</span></span>
<span class="r-in"><span>             bg4cor <span class="op">=</span> <span class="va">bg</span>,</span></span>
<span class="r-in"><span>             test <span class="op">=</span> <span class="va">test</span>,</span></span>
<span class="r-in"><span>             cor_th <span class="op">=</span> <span class="fl">0.7</span>,</span></span>
<span class="r-in"><span>             permut <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">vs</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Remove variables with correlation higher than 0.7 accounting for the TSS,</span></span></span>
<span class="r-in"><span><span class="co"># in the following example the variable importance is the MaxEnt percent</span></span></span>
<span class="r-in"><span><span class="co"># contribution</span></span></span>
<span class="r-in"><span><span class="co"># Train a model</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="train.html">train</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"Maxent"</span>,</span></span>
<span class="r-in"><span>               data <span class="op">=</span> <span class="va">train</span>,</span></span>
<span class="r-in"><span>               fc <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">vs</span> <span class="op">&lt;-</span> <span class="fu">varSel</span><span class="op">(</span><span class="va">model</span>,</span></span>
<span class="r-in"><span>             metric <span class="op">=</span> <span class="st">"tss"</span>,</span></span>
<span class="r-in"><span>             bg4cor <span class="op">=</span> <span class="va">bg</span>,</span></span>
<span class="r-in"><span>             test <span class="op">=</span> <span class="va">test</span>,</span></span>
<span class="r-in"><span>             cor_th <span class="op">=</span> <span class="fl">0.7</span>,</span></span>
<span class="r-in"><span>             use_pc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">vs</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Remove variables with correlation higher than 0.7 accounting for the aicc,</span></span></span>
<span class="r-in"><span><span class="co"># in the following example the variable importance is the MaxEnt percent</span></span></span>
<span class="r-in"><span><span class="co"># contribution</span></span></span>
<span class="r-in"><span><span class="va">vs</span> <span class="op">&lt;-</span> <span class="fu">varSel</span><span class="op">(</span><span class="va">model</span>,</span></span>
<span class="r-in"><span>             metric <span class="op">=</span> <span class="st">"aicc"</span>,</span></span>
<span class="r-in"><span>             bg4cor <span class="op">=</span> <span class="va">bg</span>,</span></span>
<span class="r-in"><span>             cor_th <span class="op">=</span> <span class="fl">0.7</span>,</span></span>
<span class="r-in"><span>             use_pc <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>             env <span class="op">=</span> <span class="va">predictors</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">vs</span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/sgvignali" class="external-link">Sergio Vignali</a>, <a href="http://www.cb.iee.unibe.ch/about_us/barras_arnaud_gian/index_eng.html" class="external-link">Arnaud Barras</a>, <a href="http://www.cb.iee.unibe.ch/about_us/dr_braunisch_veronika/index_eng.html" class="external-link">Veronika Braunisch</a>, <a href="http://www.cb.iee.unibe.ch/index_eng.html" class="external-link">Conservation Biology - University of Bern</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

