<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="SDMtune">
<title>SDMtune - variable selection • SDMtune</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="SDMtune - variable selection">
<meta property="og:description" content="SDMtune">
<meta property="og:image" content="https://consbiol-unibern.github.io/SDMtune/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SDMtune</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.2.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/articles/prepare-data.html">Prepare data for the analysis</a>
    <a class="dropdown-item" href="../articles/articles/train-model.html">Train a model</a>
    <a class="dropdown-item" href="../articles/articles/make-predictions.html">Make predictions</a>
    <a class="dropdown-item" href="../articles/articles/evaluate-model.html">Evaluate a model</a>
    <a class="dropdown-item" href="../articles/articles/evaluation-strategies.html">Evaluation strategies</a>
    <a class="dropdown-item" href="../articles/articles/variable-importance.html">Variable importance</a>
    <a class="dropdown-item" href="../articles/articles/variable-selection.html">Data-driven variable selection</a>
    <a class="dropdown-item" href="../articles/articles/tune-hyperparameters.html">Tune model hyperparameters</a>
    <a class="dropdown-item" href="../articles/articles/train-tune-presence-absence-models.html">Train and tune presence absence models</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ConsBiol-unibern/SDMtune">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>SDMtune - variable selection</h1>
                        <h4 data-toc-skip class="author">Sergio Vignali,
Arnaud Barras &amp; Veronika Braunisch</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ConsBiol-unibern/SDMtune/blob/HEAD/vignettes/var-selection.Rmd" class="external-link"><code>vignettes/var-selection.Rmd</code></a></small>
      <div class="d-none name"><code>var-selection.Rmd</code></div>
    </div>

    
    
<p><img src="../reference/figures/logo.png" width="70" style="float: right; border: none;"></p>
<div class="section level2">
<h2 id="load-data-and-train-model">Load data and train model<a class="anchor" aria-label="anchor" href="#load-data-and-train-model"></a>
</h2>
<p>The following steps are described in the <strong>basic-use</strong>
vignette, refer to it if the following code is not clear:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://consbiol-unibern.github.io/SDMtune/">SDMtune</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nteetor/zeallot" class="external-link">zeallot</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare data</span></span>
<span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"dismo"</span><span class="op">)</span>, <span class="st">"ex"</span><span class="op">)</span>,</span>
<span>                    pattern <span class="op">=</span> <span class="st">"grd"</span>,</span>
<span>                    full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">predictors</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepareSWD.html">prepareSWD</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">"Virtual species"</span>,</span>
<span>                   p <span class="op">=</span> <span class="va">virtualSp</span><span class="op">$</span><span class="va">presence</span>,</span>
<span>                   a <span class="op">=</span> <span class="va">virtualSp</span><span class="op">$</span><span class="va">background</span>,</span>
<span>                   env <span class="op">=</span> <span class="va">predictors</span>,</span>
<span>                   categorical <span class="op">=</span> <span class="st">"biome"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">train</span>, <span class="va">test</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/zeallot/man/operator.html" class="external-link">%&lt;-%</a></span> <span class="fu"><a href="../reference/trainValTest.html">trainValTest</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>                                 test <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>                                 only_presence <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 seed <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Train model</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span><span class="st">"Maxent"</span>,</span>
<span>               data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Train cross validation model</span></span>
<span><span class="va">folds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/randomFolds.html">randomFolds</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>                     k <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                     only_presence <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     seed <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cv_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span><span class="st">"Maxent"</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                  folds <span class="op">=</span> <span class="va">folds</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="variable-importance">Variable importance<a class="anchor" aria-label="anchor" href="#variable-importance"></a>
</h2>
<p>For a <strong>Maxent</strong> model we can get the variable
importance values from the output of the MaxEnt Java software. These
values are stored in the model object and can be displayed using the
following command:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">@</span><span class="va">model</span><span class="op">@</span><span class="va">results</span></span></code></pre></div>
<p>The function <code>maxentVarImp</code> extracts the variable
importance values from the previous output and formats them in a more
human readable way:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maxentVarImp.html">maxentVarImp</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="va">vi</span></span></code></pre></div>
<p>As you can see the function returns a <code>data.frame</code> with
the variable name, the percent contribution and the permutation
importance.</p>
<p>You can plot the variable importance as a bar chart using the
function <code>plotVarImp</code>. For example you can plot the percent
contribution using:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotVarImp.html">plotVarImp</a></span><span class="op">(</span><span class="va">vi</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>or the permutation importance with:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotVarImp.html">plotVarImp</a></span><span class="op">(</span><span class="va">vi</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><strong>SDMtune</strong> has its own function to compute the
permutation importance that iterates through several permutations and
return an averaged value together with the standard deviation. We will
use this function to compute the permutation importance of a
<strong>Maxnet</strong> model.</p>
<div class="section level4">
<h4 id="permutation-importance">Permutation importance<a class="anchor" aria-label="anchor" href="#permutation-importance"></a>
</h4>
<p>For this example we train a <strong>Maxnet</strong> model:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maxnet_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span><span class="st">"Maxnet"</span>,</span>
<span>                      data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span></code></pre></div>
<p>Now we can calculate the variable importance with the function
<code><a href="../reference/varImp.html">varImp()</a></code> using 5 permutations:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vi_maxnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/varImp.html">varImp</a></span><span class="op">(</span><span class="va">maxnet_model</span>,</span>
<span>                    permut <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vi_maxnet</span></span></code></pre></div>
<p>And plot it with:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotVarImp.html">plotVarImp</a></span><span class="op">(</span><span class="va">vi_maxnet</span><span class="op">)</span></span></code></pre></div>
<p>Next we compute the permutation importance for the
<strong>Maxent</strong> model using 10 permutations and compare the
results with the Maxent output:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute the permutation importance</span></span>
<span><span class="va">vi_maxent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/varImp.html">varImp</a></span><span class="op">(</span><span class="va">model</span>,</span>
<span>                    permut <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print it</span></span>
<span><span class="va">vi_maxent</span></span>
<span></span>
<span><span class="co"># Compare with Maxent output</span></span>
<span><span class="fu"><a href="../reference/maxentVarImp.html">maxentVarImp</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p>The difference is probably due to a different shuffling of the
presence and background locations during the permutation process and
because in this example we performed 10 permutations and averaged the
values.</p>
</div>
<div class="section level3">
<h3 id="jackknife-test-for-variable-importance">Jackknife test for variable importance<a class="anchor" aria-label="anchor" href="#jackknife-test-for-variable-importance"></a>
</h3>
<p>Another method to estimate the variable importance is the leave one
out Jackknife test. The test removes one variable at time and records
the change in the chosen metric. We use the function <code>doJk</code>,
the AUC as evaluation metric and the <code>maxnet_model</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jk</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/doJk.html">doJk</a></span><span class="op">(</span><span class="va">maxnet_model</span>,</span>
<span>           metric <span class="op">=</span> <span class="st">"auc"</span>,</span>
<span>           test <span class="op">=</span> <span class="va">test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">jk</span></span></code></pre></div>
<p>We can also plot the output using the function <code>plotJk</code>.
In the following example we plot the previous result and we add a line
representing the AUC of the full model trained using all the variables.
First we plot the Jackknife test for the training AUC:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotJk.html">plotJk</a></span><span class="op">(</span><span class="va">jk</span>,</span>
<span>       type <span class="op">=</span> <span class="st">"train"</span>,</span>
<span>       ref <span class="op">=</span> <span class="fu"><a href="../reference/auc.html">auc</a></span><span class="op">(</span><span class="va">maxnet_model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>and the Jackknife test for the testing AUC:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotJk.html">plotJk</a></span><span class="op">(</span><span class="va">jk</span>,</span>
<span>       type <span class="op">=</span> <span class="st">"test"</span>,</span>
<span>       ref <span class="op">=</span> <span class="fu"><a href="../reference/auc.html">auc</a></span><span class="op">(</span><span class="va">maxnet_model</span>, test <span class="op">=</span> <span class="va">test</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="response-curves">Response curves<a class="anchor" aria-label="anchor" href="#response-curves"></a>
</h3>
<p>With the function <code>plotResponse</code> is possible to plot the
marginal and the univariate response curve. Let’s plot the
<strong>cloglog</strong> univariate response curve of
<strong>bio1</strong>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotResponse.html">plotResponse</a></span><span class="op">(</span><span class="va">maxnet_model</span>,</span>
<span>             var <span class="op">=</span> <span class="st">"bio1"</span>,</span>
<span>             type <span class="op">=</span> <span class="st">"cloglog"</span>,</span>
<span>             only_presence <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             marginal <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>             rug <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>On top is displayed the rug of the presence locations and on bottom
the rug of the background locations. As another example we can plot the
<strong>logistic</strong> marginal response curve of
<strong>biome</strong> that is a categorical variable, keeping the other
variables at the mean value:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotResponse.html">plotResponse</a></span><span class="op">(</span><span class="va">maxnet_model</span>,</span>
<span>             var <span class="op">=</span> <span class="st">"biome"</span>,</span>
<span>             type <span class="op">=</span> <span class="st">"logistic"</span>,</span>
<span>             only_presence <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             marginal <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>             color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<p>In the case of an <code>SDMmodelCV</code> the response curve shows
the averaged value of the prediction together with one Standard
Deviation error interval:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotResponse.html">plotResponse</a></span><span class="op">(</span><span class="va">cv_model</span>,</span>
<span>             var <span class="op">=</span> <span class="st">"bio1"</span>,</span>
<span>             type <span class="op">=</span> <span class="st">"cloglog"</span>,</span>
<span>             only_presence <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             marginal <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>             rug <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-report">Model report<a class="anchor" aria-label="anchor" href="#model-report"></a>
</h3>
<p>All what you have learned till now con be saved and summarized
calling the function <code>modelReport</code>. The function will:</p>
<ul>
<li>save the training, background and testing locations in separated csv
files;</li>
<li>train and evaluate the model;</li>
<li>create a report in a html format with the ROC curve, threshold
values, response curves, predicted map and Jackknife test;</li>
<li>save the predicted distribution map;</li>
<li>save all the curves in the plot folder;</li>
<li>save the model with <code>.Rds</code> extension that can be loaded
in R using the <code>readRDS</code> function.</li>
</ul>
<p>The function is totally inspired by the default output of the MaxEnt
Java software <span class="citation">(Phillips, Anderson, and Schapire
2006)</span> and extends it to other methods. You can decide what to
include in the report using dedicated function arguments, like
<code>response_curves</code>, <code>jk</code> and <code>env</code> but
the function cannot be used with <code>SDMmodelCV</code> objects. Run
the following code to create a report of the <strong>Maxnet</strong>
model we trained before:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/modelReport.html">modelReport</a></span><span class="op">(</span><span class="va">maxnet_model</span>,</span>
<span>            type <span class="op">=</span> <span class="st">"cloglog"</span>,</span>
<span>            folder <span class="op">=</span> <span class="st">"virtual-sp"</span>,</span>
<span>            test <span class="op">=</span> <span class="va">test</span>,</span>
<span>            response_curves <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            only_presence <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            jk <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            env <span class="op">=</span> <span class="va">predictors</span><span class="op">)</span></span></code></pre></div>
<p>The output is displayed in the browser and all the files are saved in
the <strong>virtual-sp</strong> folder.</p>
</div>
</div>
<div class="section level2">
<h2 id="data-driven-variable-selection">Data-driven variable selection<a class="anchor" aria-label="anchor" href="#data-driven-variable-selection"></a>
</h2>
<p>To explore correlation among the variables we extract 10000
background locations using the function<code>randomPoints</code>
included in the <code>dismo</code> package (we set the seed to have
reproducible results). After we create an <code>SWD</code> object using
the <code>prepareSWD</code> function:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span></span>
<span><span class="va">bg</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/sample.html" class="external-link">spatSample</a></span><span class="op">(</span><span class="va">predictors</span>,</span>
<span>                        size <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>                        method <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>                        na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                        xy <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                        values <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepareSWD.html">prepareSWD</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">"Bgs"</span>,</span>
<span>                 a <span class="op">=</span> <span class="va">bg</span>,</span>
<span>                 env <span class="op">=</span> <span class="va">predictors</span>,</span>
<span>                 categorical <span class="op">=</span> <span class="st">"biome"</span><span class="op">)</span></span></code></pre></div>
<p>The environmental variables we downloaded have a coarse resolution
and the function can extract a bit less than 10000 random locations (see
the warning message).</p>
<p>With the function <code>plotCor</code> you can create an heat map
showing the degree of autocorrelation:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotCor.html">plotCor</a></span><span class="op">(</span><span class="va">bg</span>,</span>
<span>        method <span class="op">=</span> <span class="st">"spearman"</span>,</span>
<span>        cor_th <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span></code></pre></div>
<p>You can select a different correlation method or set a different
correlation threshold. Another useful function is <code>corVar</code>
that instead of creating a heat map prints the pairs of correlated
variables according to the given method and correlation threshold:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/corVar.html">corVar</a></span><span class="op">(</span><span class="va">bg</span>,</span>
<span>       method <span class="op">=</span> <span class="st">"spearman"</span>,</span>
<span>       cor_th <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span></code></pre></div>
<p>As you can see there are few variables that have a correlation
coefficient greater than 0.7 in absolute value.</p>
<div class="section level3">
<h3 id="remove-highly-correlated-variables">Remove highly correlated variables<a class="anchor" aria-label="anchor" href="#remove-highly-correlated-variables"></a>
</h3>
<p><strong>SDMtune</strong> implements an algorithm that removes highly
correlated variables repeating the following steps:</p>
<ol style="list-style-type: decimal">
<li>ranks the variables according to the permutation importance or the
percent contribution (the second method is available only for Maxent
models).</li>
<li>checks if the variable ranked as most important is highly correlated
with other variables, according to the given method and correlation
threshold. If the algorithm finds correlated variables it moves to the
next step, otherwise checks the other variables in the rank;</li>
<li>performs a leave one out Jackknife test among the correlated
variables;</li>
<li>remove the variable that decreases the less the model performance
when removed, according to the given metric on the training
dataset.</li>
</ol>
<p>The process is repeated until the remaining variables have a
correlation coefficient lower than the provided correlation threshold.
In the next example we remove the variables that have a
<strong>Spearman</strong> correlation coefficient <span class="math inline">\(|r_s|\leq0.7\)</span> and checking the AUC on the
training dataset (we use only one permutation to save time but you are
free to increase this value). If you use RStudio, the function creates
an interactive real-time chart in the viewer pane. Run the following
code and hover over the chart during the execution of the function to
get extra information:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">selected_variables_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/varSel.html">varSel</a></span><span class="op">(</span><span class="va">maxnet_model</span>,</span>
<span>                                   metric <span class="op">=</span> <span class="st">"auc"</span>,</span>
<span>                                   test <span class="op">=</span> <span class="va">test</span>,</span>
<span>                                   bg4cor <span class="op">=</span> <span class="va">bg</span>,</span>
<span>                                   method <span class="op">=</span> <span class="st">"spearman"</span>,</span>
<span>                                   cor_th <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>                                   permut <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>As you can see some variables have been removed. The output of the
function is the model trained with the selected variables:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">selected_variables_model</span></span></code></pre></div>
<p>In the next example we remove the highly correlated variables using
the <strong>Maxent</strong> model, ranking the variables with the
percent contribution and using the AICc as evaluation metric:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">selected_variables_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/varSel.html">varSel</a></span><span class="op">(</span><span class="va">model</span>,</span>
<span>                                   metric <span class="op">=</span> <span class="st">"aicc"</span>,</span>
<span>                                   bg4cor <span class="op">=</span> <span class="va">bg</span>,</span>
<span>                                   method <span class="op">=</span> <span class="st">"spearman"</span>,</span>
<span>                                   cor_th <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>                                   env <span class="op">=</span> <span class="va">predictors</span>,</span>
<span>                                   use_pc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="remove-variables-with-low-importance">Remove variables with low importance<a class="anchor" aria-label="anchor" href="#remove-variables-with-low-importance"></a>
</h3>
<p>There are cases in which a model has some environmental variables
ranked with very low contribution and you may want to remove some of
them to reduce the model complexity. <strong>SDMtune</strong> offers two
different strategies implemented in the function <code>reduceVar</code>.
We will use the <strong>Maxent</strong> model trained with all the
variables. Let’s first check the permutation importance (we use only one
permutation to save time):</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/varImp.html">varImp</a></span><span class="op">(</span><span class="va">model</span>,</span>
<span>       permut <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>In the first example we want to remove all the environmental
variables that have a permutation importance lower than 6%, no matter if
the model performance decreases. The function removes the last ranked
environmental variable, trains a new model and computes a new rank. The
process is repeated until all the remaining environmental variables have
an importance greater than 6%:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Testing AUC before: "</span>, <span class="fu"><a href="../reference/auc.html">auc</a></span><span class="op">(</span><span class="va">maxnet_model</span>, test <span class="op">=</span> <span class="va">test</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">reduced_variables_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduceVar.html">reduceVar</a></span><span class="op">(</span><span class="va">maxnet_model</span>,</span>
<span>                                     th <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                                     metric <span class="op">=</span> <span class="st">"auc"</span>,</span>
<span>                                     test <span class="op">=</span> <span class="va">test</span>,</span>
<span>                                     permut <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Testing AUC after: "</span>, <span class="fu"><a href="../reference/auc.html">auc</a></span><span class="op">(</span><span class="va">reduced_variables_model</span>, test <span class="op">=</span> <span class="va">test</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In the second example we want to remove the environmental variables
that have a permutation importance lower than 15% only if removing the
variables the model performance does not decrease, according to the
given metric. In this case the function performs a leave one out
Jackknife test and remove the environmental variables in a step-wise
fashion as described in the previous example, but only if the model
performance doesn’t drop:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Testing AUC before: "</span>, <span class="fu"><a href="../reference/auc.html">auc</a></span><span class="op">(</span><span class="va">maxnet_model</span>, test <span class="op">=</span> <span class="va">test</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">reduced_variables_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reduceVar.html">reduceVar</a></span><span class="op">(</span><span class="va">maxnet_model</span>,</span>
<span>                                     th <span class="op">=</span> <span class="fl">15</span>, metric <span class="op">=</span> <span class="st">"auc"</span>,</span>
<span>                                     test <span class="op">=</span> <span class="va">test</span>,</span>
<span>                                     permut <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                     use_jk <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Testing AUC after: "</span>, <span class="fu"><a href="../reference/auc.html">auc</a></span><span class="op">(</span><span class="va">reduced_variables_model</span>, test <span class="op">=</span> <span class="va">test</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>As you can see in this case several variables have been removed and
the AUC in the testing dataset didn’t decrease.</p>
</div>
<div class="section level3">
<h3 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Phillips2006" class="csl-entry">
Phillips, Steven J, Robert P Anderson, and Robert E Schapire. 2006.
<span>“<span class="nocase">Maximum entropy modeling of species
geographic distributions</span>.”</span> <em>Ecological Modelling</em>
190: 231–59. <a href="https://doi.org/10.1016/j.ecolmodel.2005.03.026" class="external-link">https://doi.org/10.1016/j.ecolmodel.2005.03.026</a>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://github.com/sgvignali" class="external-link">Sergio Vignali</a>, <a href="http://www.cb.iee.unibe.ch/about_us/barras_arnaud_gian/index_eng.html" class="external-link">Arnaud Barras</a>, <a href="http://www.cb.iee.unibe.ch/about_us/dr_braunisch_veronika/index_eng.html" class="external-link">Veronika Braunisch</a>, <a href="http://www.cb.iee.unibe.ch/index_eng.html" class="external-link">Conservation Biology - University of Bern</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
