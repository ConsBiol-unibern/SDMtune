<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tune model hyperparameters • SDMtune</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><!-- docsearch --><script src="../../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../../extra.css" rel="stylesheet">
<meta property="og:title" content="Tune model hyperparameters">
<meta property="og:description" content="">
<meta property="og:image" content="https://consbiol-unibern.github.io/SDMtune/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">SDMtune</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/SDMtune.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/prepare_data.html">Prepare data for the analysis</a>
    </li>
    <li>
      <a href="../../articles/articles/train_model.html">Train a model</a>
    </li>
    <li>
      <a href="../../articles/articles/make_predictions.html">Make predictions</a>
    </li>
    <li>
      <a href="../../articles/articles/evaluate_model.html">Evaluate a model</a>
    </li>
    <li>
      <a href="../../articles/articles/evaluation_strategies.html">Evaluation strategies</a>
    </li>
    <li>
      <a href="../../articles/articles/variable_importance.html">Variable importance</a>
    </li>
    <li>
      <a href="../../articles/articles/variable_selection.html">Data-driven variable selection</a>
    </li>
    <li>
      <a href="../../articles/articles/tune_hyperparameters.html">Tune model hyperparameters</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ConsBiol-unibern/SDMtune">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Tune model hyperparameters</h1>
            
      
      
      <div class="hidden name"><code>tune_hyperparameters.Rmd</code></div>

    </div>

    
    
<div id="intro" class="section level2">
<h2 class="hasAnchor">
<a href="#intro" class="anchor"></a>Intro</h2>
<p>In the previous articles you have learned the core functions of <strong>SDMtune</strong> and how to perform <a href="./variable_selection.html">data-driven variable selection</a>. In this article you will learn how to tune the model hyperparameters.</p>
</div>
<div id="training-validation-and-testing-split" class="section level2">
<h2 class="hasAnchor">
<a href="#training-validation-and-testing-split" class="anchor"></a>Training, validation and testing split</h2>
<p>When you tune the model hyperparameters you iteratively adjust the hyperparameters while monitoring the changes in the evaluation metric computed using the testing dataset. In this process, the information contained in the testing dataset leaks in the model and therefore, at the end of the process, the testing dataset doesn’t represent anymore an independent set to evaluate the model <span class="citation">(Müller and Guido 2016, <span class="citation">@Chollet2018</span>)</span>. A better strategy, than splitting the observation locations in training and testing, would be to split them into training, validation and testing datasets. The training dataset is then used to train the model, the validation datasets to drive the hyperparameter tuning and the testing dataset to evaluate the tuned model. The function <code><a href="../../reference/trainValTest.html">trainValTest()</a></code> allows to split the data in three folds containing the provided percentage of data. For illustration purpose let’s split the presence locations in training (60%), validation (20%) and testing (20%) datasets:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(zeallot)  <span class="co"># For unpacking assignment</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(train, val, test) <span class="op">%&lt;-%</span><span class="st"> </span><span class="kw"><a href="../../reference/trainValTest.html">trainValTest</a></span>(presence, <span class="dt">val =</span> <span class="fl">0.2</span>, <span class="dt">test =</span> <span class="fl">0.2</span>, <span class="dt">seed =</span> <span class="dv">25</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"# Training  : "</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(train<span class="op">@</span>data))</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt; # Training  :  306</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"# Validation: "</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(val<span class="op">@</span>data))</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt; # Validation:  102</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"# Testing   : "</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(test<span class="op">@</span>data))</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt; # Testing   :  102</span></a></code></pre></div>
<p>We now train a <strong>Maxnet</strong> model with default settings and using the training dataset:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">model &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/train.html">train</a></span>(<span class="st">"Maxnet"</span>, <span class="dt">p =</span> train, <span class="dt">a =</span> bg_model)</a></code></pre></div>
<p>Another approach would be to split the data in two folds: training and testing, use the cross validation strategy with the training dataset to tune the model hyperparameters, and evaluate the tuned model with the unseen held apart testing dataset. For execution time reason we demonstrate the first approach but you are free to try out the second one.</p>
</div>
<div id="check-the-effect-of-varying-one-hyperparameter" class="section level2">
<h2 class="hasAnchor">
<a href="#check-the-effect-of-varying-one-hyperparameter" class="anchor"></a>Check the effect of varying one hyperparameter</h2>
<p>To see the effect of varying one hyperparameter on the model performance we can use the function <code><a href="../../reference/gridSearch.html">gridSearch()</a></code>. The function iterates through a set of predefined hyperparameter values, train the model and displays in real-time the evaluation metric in the RStudio viewer pane (hover over the points to get a tooltip with extra information). Let’s see how the AUC changes varying the number of background locations. First we have to define the values for the hyperparameter that we want to test. For that we create a named list that we will use as an argument for the function <code><a href="../../reference/gridSearch.html">gridSearch()</a></code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># Define the values for bg</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">h &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">a =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">4000</span>, <span class="dv">9000</span>, <span class="dv">1000</span>))</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co"># Call the gridSearch function</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">exp_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/gridSearch.html">gridSearch</a></span>(model, <span class="dt">hypers =</span> h, <span class="dt">metric =</span> <span class="st">"auc"</span>, <span class="dt">test =</span> val, <span class="dt">bg4test =</span> bg, <span class="dt">seed =</span> <span class="dv">2525</span>)</a></code></pre></div>
<p>As you noticed we used the validation dataset as test argument, and the total number of background locations as bg4test argument. The <code>bg</code> datasets contains almost 10000 locations and is used to randomly get the number of backgrounds defined in <code>h</code>. We also set the seed to get the same result. The output of the function is an object of class <code><a href="../../reference/SDMtune-class.html">SDMtune()</a></code>. Let’s print it:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">exp_<span class="dv">1</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#&gt; Object of class:  SDMtune </span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt; Model configurations:</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; --------------------</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; a: 4000, 5000, 6000, 7000, 8000, 9000</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; fc: lqph</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt; reg: 1</span></a></code></pre></div>
<p>When you print the output, the text contains the model configurations that have been used during the execution of the function. In our case, only the number of backgrounds <code>a</code> has multiple values. You can plot the <code><a href="../../reference/SDMtune-class.html">SDMtune()</a></code> object:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(exp_<span class="dv">1</span>)</a></code></pre></div>
<p><img src="tune_hyperparameters_files/figure-html/plot%20exp_1-1.png" width="700" style="display: block; margin: auto;"></p>
<p>and you can also recreate the interactive chart using:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(exp_<span class="dv">1</span>, <span class="dt">interactive =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div id="try-yourself" class="section level3">
<h3 class="hasAnchor">
<a href="#try-yourself" class="anchor"></a>Try yourself</h3>
<p>Try to see how TSS changes varying the regularization multiplier from 0.5 to 3 with increments of 0.5 (highlight to see the solution):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r exercise"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># Define the values for reg</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">h &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">reg =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="fl">0.5</span>, <span class="dv">3</span>, <span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co"># Call the gridSearch function</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4">exp_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/gridSearch.html">gridSearch</a></span>(model, <span class="dt">hypers =</span> h, <span class="dt">metric =</span> <span class="st">"tss"</span>, <span class="dt">test =</span> val, <span class="dt">seed =</span> <span class="dv">68468</span>)</a></code></pre></div>
<p>and how AUC changes varying the feature combinations using the following values: l, lq, lh, lqp, lqph and lqpht (highlight to see the solution):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r exercise"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># Define the values for fc</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">h &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">fc =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"l"</span>, <span class="st">"lq"</span>, <span class="st">"lh"</span>, <span class="st">"lqp"</span>, <span class="st">"lqph"</span>, <span class="st">"lqpht"</span>))</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co"># Call the gridSearch function</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4">exp_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/gridSearch.html">gridSearch</a></span>(model, <span class="dt">hypers =</span> h, <span class="dt">metric =</span> <span class="st">"auc"</span>, <span class="dt">test =</span> val, <span class="dt">seed =</span> <span class="dv">9948</span>)</a></code></pre></div>
<p>Train a <strong>Maxent</strong> model and see how the AUC changes varying the number of iterations from 300 to 1100 with increments of 200 (highlight to see the solution):</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r exercise"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">maxent_model &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/train.html">train</a></span>(<span class="st">"Maxent"</span>, <span class="dt">p =</span> train, <span class="dt">a =</span> bg_model)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co"># Define the values for fc</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">h &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="st">"iter"</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">300</span>, <span class="dv">1100</span>, <span class="dv">200</span>))</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co"># Call the gridSearch function</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">exp_<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/gridSearch.html">gridSearch</a></span>(maxent_model, <span class="dt">hypers =</span> h, <span class="dt">metric =</span> <span class="st">"auc"</span>, <span class="dt">test =</span> val, <span class="dt">seed =</span> <span class="dv">3516</span>)</a></code></pre></div>
<p>To see which hyperparameters can be tuned in a given model use the function <code><a href="../../reference/get_tunable_args.html">get_tunable_args()</a></code>. For example:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="../../reference/get_tunable_args.html">get_tunable_args</a></span>(model)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt; [1] "a"   "fc"  "reg"</span></a></code></pre></div>
</div>
</div>
<div id="tune-hyperparameters" class="section level2">
<h2 class="hasAnchor">
<a href="#tune-hyperparameters" class="anchor"></a>Tune hyperparameters</h2>
<p>To tune the model hyperparameters you should run all the possible combinations of hyperparameters. Here is an example using combinations of regularization multiplier and feature classes:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">h &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">reg =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="fl">0.5</span>, <span class="dv">5</span>, <span class="fl">0.5</span>), <span class="dt">fc =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"l"</span>, <span class="st">"lq"</span>, <span class="st">"lh"</span>, <span class="st">"lqp"</span>, <span class="st">"lqph"</span>, <span class="st">"lqpht"</span>))</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">exp_<span class="dv">5</span> &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/gridSearch.html">gridSearch</a></span>(model, <span class="dt">hypers =</span> h, <span class="dt">metric =</span> <span class="st">"auc"</span>, <span class="dt">test =</span> val, <span class="dt">seed =</span> <span class="dv">5165</span>)</a></code></pre></div>
<p>This code takes already quite long as it has to train 60 models. Imagine if you want to check also for different number of background locations, decrease the increments for the regularization multiplier values and maybe add the number of iterations (in the case of a <strong>Maxent</strong> model). The number of models to be trained increases exponentially and consequently the execution time. In the next two paragraphs we will present two possible alternative to the <code><a href="../../reference/gridSearch.html">gridSearch()</a></code> function.</p>
</div>
<div id="random-search" class="section level2">
<h2 class="hasAnchor">
<a href="#random-search" class="anchor"></a>Random search</h2>
<p>The function <code><a href="../../reference/randomSearch.html">randomSearch()</a></code> trains models taking a random sample of the predefined configurations. In the next example we select 20 random configurations:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">h &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">a =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">4000</span>, <span class="dv">9000</span>, <span class="dv">500</span>), <span class="dt">reg =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="fl">0.2</span>, <span class="dv">5</span>, <span class="fl">0.2</span>), <span class="dt">fc =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"l"</span>, <span class="st">"lq"</span>, <span class="st">"lh"</span>, <span class="st">"lp"</span>, <span class="st">"lqp"</span>, <span class="st">"lqph"</span>))</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">exp_<span class="dv">6</span> &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/randomSearch.html">randomSearch</a></span>(model, <span class="dt">hypers =</span> h, <span class="dt">metric =</span> <span class="st">"auc"</span>, <span class="dt">test =</span> val, <span class="dt">bg4test =</span> bg, <span class="dt">pop =</span> <span class="dv">20</span>, <span class="dt">seed =</span> <span class="dv">65651</span>)</a></code></pre></div>
<p>The real-time chart plots two different graphs, one with the chosen metric for each trained model and one with the evaluation metric for the starting and the best found model. As you can see, the function is able to find a better combination of the model hyperparameters compared to the starting model; and this training only 20 instead of 1650 models. The results includes the 20 trained model. If you are not happy with the solution, you can check the best hyperparameter combinations and this gives you an intuition of which ones are the hyperparameters to “refine” using the function <code><a href="../../reference/gridSearch.html">gridSearch()</a></code>. The <code><a href="../../reference/SDMtune-class.html">SDMtune()</a></code> object stores the results in a <code>data.frame</code> than can be accessed with the following command:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">exp_<span class="dv">6</span><span class="op">@</span>results</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="co">#&gt;       a   fc reg train_AUC test_AUC diff_AUC</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="co">#&gt; 1  8000   lh 0.8    0.9400   0.9155   0.0245</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co">#&gt; 2  8500 lqph 1.8    0.9340   0.9139   0.0201</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co">#&gt; 3  7500   lh 1.4    0.9351   0.9132   0.0219</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="co">#&gt; 4  5000 lqph 2.2    0.9319   0.9113   0.0206</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co">#&gt; 5  6000   lh 3.2    0.9228   0.9090   0.0138</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co">#&gt; 6  8000   lh 4.6    0.9195   0.9088   0.0107</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="co">#&gt; 7  7000  lqp 1.4    0.9281   0.9072   0.0209</span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="co">#&gt; 8  7500   lp 3.4    0.9185   0.9070   0.0115</span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="co">#&gt; 9  6500  lqp 2.0    0.9257   0.9067   0.0190</span></a>
<a class="sourceLine" id="cb13-12" data-line-number="12"><span class="co">#&gt; 10 7000  lqp 0.8    0.9309   0.9061   0.0248</span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13"><span class="co">#&gt; 11 7000   lp 4.0    0.9169   0.9056   0.0113</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14"><span class="co">#&gt; 12 4500  lqp 2.6    0.9227   0.9054   0.0173</span></a>
<a class="sourceLine" id="cb13-15" data-line-number="15"><span class="co">#&gt; 13 7000  lqp 0.4    0.9324   0.9052   0.0272</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16"><span class="co">#&gt; 14 7500  lqp 5.0    0.9160   0.9044   0.0116</span></a>
<a class="sourceLine" id="cb13-17" data-line-number="17"><span class="co">#&gt; 15 6000  lqp 3.0    0.9207   0.9041   0.0166</span></a>
<a class="sourceLine" id="cb13-18" data-line-number="18"><span class="co">#&gt; 16 6000   lp 3.6    0.9162   0.9041   0.0121</span></a>
<a class="sourceLine" id="cb13-19" data-line-number="19"><span class="co">#&gt; 17 4000   lp 4.2    0.9156   0.9039   0.0117</span></a>
<a class="sourceLine" id="cb13-20" data-line-number="20"><span class="co">#&gt; 18 5500  lqp 0.6    0.9314   0.9036   0.0278</span></a>
<a class="sourceLine" id="cb13-21" data-line-number="21"><span class="co">#&gt; 19 9000  lqp 5.0    0.9141   0.9023   0.0118</span></a>
<a class="sourceLine" id="cb13-22" data-line-number="22"><span class="co">#&gt; 20 5000    l 0.2    0.9069   0.8871   0.0198</span></a></code></pre></div>
</div>
<div id="optimize-model" class="section level2">
<h2 class="hasAnchor">
<a href="#optimize-model" class="anchor"></a>Optimize Model</h2>
<p>The previous function doesn’t learn anything from the trained models, it just selects n random combinations of hyperparameters. The function <code><a href="../../reference/optimizeModel.html">optimizeModel()</a></code> uses a genetic algorithm to find an optimum solution. Check the function documentation to understand how it works, here we provide the code to execute it:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">exp_<span class="dv">7</span> &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/optimizeModel.html">optimizeModel</a></span>(model, <span class="dt">hypers =</span> h, <span class="dt">metric =</span> <span class="st">"auc"</span>, <span class="dt">test =</span> val, <span class="dt">bg4test =</span> bg, <span class="dt">pop =</span> <span class="dv">20</span>, <span class="dt">gen =</span> <span class="dv">5</span>, <span class="dt">keep_best =</span> <span class="fl">0.4</span>, <span class="dt">keep_random =</span> <span class="fl">0.2</span>, <span class="dt">mutation_chance =</span> <span class="fl">0.4</span>, <span class="dt">seed =</span> <span class="dv">65651</span>)</a></code></pre></div>
</div>
<div id="evaluate-final-model" class="section level2">
<h2 class="hasAnchor">
<a href="#evaluate-final-model" class="anchor"></a>Evaluate final model</h2>
<p>Let’s say we want to use the best tuned model found by the <code><a href="../../reference/randomSearch.html">randomSearch()</a></code> function. Before evaluating the model using the testing dataset, we can merge the training and the validation datasets together to increase the number of locations and train the model with the merged observations and the tuned configuration. We merge the two datasets using the <code><a href="../../reference/mergeSWD.html">mergeSWD()</a></code> function:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">merged_data &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/mergeSWD.html">mergeSWD</a></span>(train, val)</a></code></pre></div>
<p>Then we get the model configuration from the experiment 6:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(exp_<span class="dv">6</span><span class="op">@</span>results)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="co">#&gt;      a   fc reg train_AUC test_AUC diff_AUC</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="co">#&gt; 1 8000   lh 0.8    0.9400   0.9155   0.0245</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="co">#&gt; 2 8500 lqph 1.8    0.9340   0.9139   0.0201</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="co">#&gt; 3 7500   lh 1.4    0.9351   0.9132   0.0219</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="co">#&gt; 4 5000 lqph 2.2    0.9319   0.9113   0.0206</span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="co">#&gt; 5 6000   lh 3.2    0.9228   0.9090   0.0138</span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="co">#&gt; 6 8000   lh 4.6    0.9195   0.9088   0.0107</span></a></code></pre></div>
<p>The best model was trained using <strong>8000</strong> background locations (we can select the same background locations with <code>exp_6@models[[1]]@a</code>), <strong>lh</strong> as feature class combination and a regularization multiplier equal to <strong>0.8</strong>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">final_model &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/train.html">train</a></span>(<span class="st">"Maxnet"</span>, <span class="dt">p =</span> merged_data, <span class="dt">a =</span> exp_<span class="dv">6</span><span class="op">@</span>models[[<span class="dv">1</span>]]<span class="op">@</span>a, <span class="dt">fc =</span> exp_<span class="dv">6</span><span class="op">@</span>results[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dt">reg =</span> exp_<span class="dv">6</span><span class="op">@</span>results[<span class="dv">1</span>, <span class="dv">3</span>])</a></code></pre></div>
<p>Now we can evaluate it using the held apart testing dataset:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw"><a href="../../reference/auc.html">auc</a></span>(final_model, <span class="dt">test =</span> test)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="co">#&gt; [1] 0.9365</span></a></code></pre></div>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>In this article you have learned:</p>
<ul>
<li>the training/validation/testing evaluation strategy;</li>
<li>how to explore the effect of changing one model hyperparameter at time;</li>
<li>how to tune the model hyperparameters using three different functions;</li>
<li>how to merge two <code><a href="../../reference/SWD-class.html">SWD()</a></code> objects;</li>
<li>how to evaluate a final model using the held apart testing dataset.</li>
</ul>
<div id="references" class="section level3 unnumbered">
<h3 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h3>
<div id="refs" class="references">
<div id="ref-Chollet2018">
<p>Chollet, François, and J. J. Allaire. 2018. <em>Deep learning with R</em>. 1st ed. Manning Publications Co.</p>
</div>
<div id="ref-Muller2016">
<p>Müller, Andreas C., and Sarah Guido. 2016. <em>Introduction to machine learning with Python : a guide for data scientists</em>.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#intro">Intro</a></li>
      <li><a href="#training-validation-and-testing-split">Training, validation and testing split</a></li>
      <li><a href="#check-the-effect-of-varying-one-hyperparameter">Check the effect of varying one hyperparameter</a></li>
      <li><a href="#tune-hyperparameters">Tune hyperparameters</a></li>
      <li><a href="#random-search">Random search</a></li>
      <li><a href="#optimize-model">Optimize Model</a></li>
      <li><a href="#evaluate-final-model">Evaluate final model</a></li>
      <li><a href="#conclusion">Conclusion</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://github.com/sgvignali">Sergio Vignali</a>, <a href="http://www.cb.iee.unibe.ch/about_us/barras_arnaud_gian/index_eng.html">Arnaud Barras</a>, <a href="http://www.cb.iee.unibe.ch/about_us/dr_braunisch_veronika/index_eng.html">Veronika Braunisch</a>, <a href="http://www.cb.iee.unibe.ch/index_eng.html">Conservation Biology - University of Bern</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'f5b56329d14fa0bab34fea62e13b450d',
    indexName: 'sgvignali-sdmtune',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
