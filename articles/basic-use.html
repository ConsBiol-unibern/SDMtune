<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>SDMtune - basic use • SDMtune</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="SDMtune - basic use">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SDMtune</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/articles/prepare-data.html">Prepare data for the analysis</a></li>
    <li><a class="dropdown-item" href="../articles/articles/train-model.html">Train a model</a></li>
    <li><a class="dropdown-item" href="../articles/articles/make-predictions.html">Make predictions</a></li>
    <li><a class="dropdown-item" href="../articles/articles/evaluate-model.html">Evaluate a model</a></li>
    <li><a class="dropdown-item" href="../articles/articles/evaluation-strategies.html">Evaluation strategies</a></li>
    <li><a class="dropdown-item" href="../articles/articles/variable-importance.html">Variable importance</a></li>
    <li><a class="dropdown-item" href="../articles/articles/variable-selection.html">Data-driven variable selection</a></li>
    <li><a class="dropdown-item" href="../articles/articles/tune-hyperparameters.html">Tune model hyperparameters</a></li>
    <li><a class="dropdown-item" href="../articles/articles/train-tune-presence-absence-models.html">Train and tune presence absence models</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ConsBiol-unibern/SDMtune"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>SDMtune - basic use</h1>
                        <h4 data-toc-skip class="author">Sergio Vignali,
Arnaud Barras &amp; Veronika Braunisch</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ConsBiol-unibern/SDMtune/blob/master/vignettes/basic-use.Rmd" class="external-link"><code>vignettes/basic-use.Rmd</code></a></small>
      <div class="d-none name"><code>basic-use.Rmd</code></div>
    </div>

    
    
<p><img src="../reference/figures/logo.png" width="70" style="float: right; border: none;"></p>
<div class="section level2">
<h2 id="prepare-data-for-the-analysis">Prepare data for the analysis<a class="anchor" aria-label="anchor" href="#prepare-data-for-the-analysis"></a>
</h2>
<p>In this section you will learn how to prepare the data to train
models using <code>SDMtune</code>. We will use the
<code>virtualSp</code> dataset included in the package and environmental
predictors from the <a href="https://www.worldclim.org/" class="external-link">WorldClim</a>
dataset.</p>
<p>First let’s load some packages that we will use to visualize the
data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>    <span class="co"># To plot locations</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/adeckmyn/maps" class="external-link">maps</a></span><span class="op">)</span>       <span class="co"># To access useful maps</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://oscarperpinan.github.io/rastervis/" class="external-link">rasterVis</a></span><span class="op">)</span>  <span class="co"># To plot raster objects</span></span></code></pre></div>
<div class="section level3">
<h3 id="acquire-environmental-variables">Acquire environmental variables<a class="anchor" aria-label="anchor" href="#acquire-environmental-variables"></a>
</h3>
<p>We use the climate data of <a href="https://www.worldclim.org/" class="external-link">WorldClim</a> version 1.4 <span class="citation">(Hijmans et al. 2005)</span> and the <a href="https://www.worldwildlife.org/publications/terrestrial-ecoregions-of-the-world" class="external-link">terrestrial
ecoregions</a> from WWF <span class="citation">(Olson et al.
2001)</span> included in the <code>dismo</code> package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"dismo"</span><span class="op">)</span>, <span class="st">"ex"</span><span class="op">)</span>,</span>
<span>                    pattern <span class="op">=</span> <span class="st">"grd"</span>,</span>
<span>                    full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>We convert these files in a <code>raster</code> object that will be
used later in the analysis:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predictors</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span></span></code></pre></div>
<p>There are nine environmental variables, eight continuous and one
categorical:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">predictors</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Continuous variables
<ul>
<li>
<strong>bio1</strong> Annual Mean Temperature</li>
<li>
<strong>bio5</strong> Max Temperature of Warmest Month</li>
<li>
<strong>bio6</strong> Min Temperature of Coldest Month</li>
<li>
<strong>bio7</strong> Temperature Annual Range (bio5-bio6)</li>
<li>
<strong>bio8</strong> Mean Temperature of Wettest Quarter</li>
<li>
<strong>bio12</strong> Annual Precipitation</li>
<li>
<strong>bio16</strong> Precipitation of Wettest Quarter</li>
<li>
<strong>bio17</strong> Precipitation of Driest Quarter</li>
</ul>
</li>
<li>Categorical variables
<ul>
<li>
<strong>biome</strong> Terrestrial Ecoregions of the World</li>
</ul>
</li>
</ul>
<p>We can plot <strong>bio1</strong> using the <code>gplot</code>
function from the <code>rasterVis</code> package:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/gplot-methods.html" class="external-link">gplot</a></span><span class="op">(</span><span class="va">predictors</span><span class="op">$</span><span class="va">bio1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#2c7bb6"</span>, <span class="st">"#abd9e9"</span>, <span class="st">"#ffffbf"</span>, <span class="st">"#fdae61"</span>, <span class="st">"#d7191c"</span><span class="op">)</span>,</span>
<span>                         na.value <span class="op">=</span> <span class="st">"transparent"</span>,</span>
<span>                         name <span class="op">=</span> <span class="st">"°C x 10"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Annual Mean Temperature"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"longitude"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"latitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>          axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="prepare-presence-and-background-locations">Prepare presence and background locations<a class="anchor" aria-label="anchor" href="#prepare-presence-and-background-locations"></a>
</h3>
<p>Let’s load the <strong>SDMtune</strong> package:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://consbiol-unibern.github.io/SDMtune/">SDMtune</a></span><span class="op">)</span></span></code></pre></div>
<p>For demonstrating how to use <code>SDMtune</code> we use the random
generated <code>virtualSp</code> dataset included in the package.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span><span class="va">virtualSp</span><span class="op">)</span></span>
<span><span class="va">p_coords</span> <span class="op">&lt;-</span> <span class="va">virtualSp</span><span class="op">$</span><span class="va">presence</span></span>
<span><span class="va">bg_coords</span> <span class="op">&lt;-</span> <span class="va">virtualSp</span><span class="op">$</span><span class="va">background</span></span></code></pre></div>
<p>Plot the study area together with the presence locations:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html" class="external-link">map_data</a></span><span class="op">(</span><span class="st">"world"</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">long</span>, <span class="va">lat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey95"</span>, color <span class="op">=</span> <span class="st">"gray40"</span>, size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">p_coords</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>                alpha <span class="op">=</span> <span class="fl">0.4</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"longitude"</span>, y <span class="op">=</span> <span class="st">"latitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">125</span>, <span class="op">-</span><span class="fl">32</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">56</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To plot the background locations run the following code:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html" class="external-link">map_data</a></span><span class="op">(</span><span class="st">"world"</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">long</span>, <span class="va">lat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey95"</span>, color <span class="op">=</span> <span class="st">"gray40"</span>, size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">bg_coords</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>,</span>
<span>                color <span class="op">=</span> <span class="st">"blue"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"longitude"</span>, y <span class="op">=</span> <span class="st">"latitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">125</span>, <span class="op">-</span><span class="fl">32</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">56</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-an-swd-object">Create an SWD object<a class="anchor" aria-label="anchor" href="#create-an-swd-object"></a>
</h3>
<p>Before training a model we have to prepare the data in the correct
format. The <code>prepareSWD</code> function creates an <code>SWD</code>
object that stores the species’ name, the coordinates of the species at
presence and absence/background locations and the value of the
environmental variables at the locations. The argument
<code>categorical</code> indicates which environmental variables are
categorical. In our example <strong>biome</strong> is categorical (we
can pass a vector if we have more than one categorical environmental
variable). The function extracts the value of the environmental
variables for each location and excludes those locations that have
<code>NA</code> value for at least one environmental variable.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepareSWD.html">prepareSWD</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">"Virtual species"</span>, </span>
<span>                   p <span class="op">=</span> <span class="va">p_coords</span>, </span>
<span>                   a <span class="op">=</span> <span class="va">bg_coords</span>,</span>
<span>                   env <span class="op">=</span> <span class="va">predictors</span>, </span>
<span>                   categorical <span class="op">=</span> <span class="st">"biome"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="explore-the-swd-object">Explore the SWD object<a class="anchor" aria-label="anchor" href="#explore-the-swd-object"></a>
</h3>
<p>Let’s have a look at the <code>SWD</code> object that we have just
created:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span></span></code></pre></div>
<p>When we print an <code>SWD</code> object we get a bunch of
information:</p>
<ul>
<li>the name of the class;</li>
<li>the name of the species;</li>
<li>the number of presence locations;</li>
<li>the number of absence/background locations;</li>
<li>the environmental variables available in the dataset:
<ul>
<li>the name of the continuous environmental variables, if any;</li>
<li>the name of the categorical environmental variables, if any.</li>
</ul>
</li>
</ul>
<p>The object contains four slots: <code>@species</code>,
<code>@coords</code> <code>@data</code> and <code>@pa</code>.
<code>@pa</code> contains a vector with 1 for presence and 0 for
absence/background locations. To visualize the data we run:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">@</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p>We can visualize the coordinates with:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">@</span><span class="va">coords</span><span class="op">)</span></span></code></pre></div>
<p>or the name of the species with:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span><span class="op">@</span><span class="va">species</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="save-an-swd-object">Save an SWD object<a class="anchor" aria-label="anchor" href="#save-an-swd-object"></a>
</h3>
<p>We can save the <code>SWD</code> object in a <strong>.csv</strong>
file using the function <code>swd2csv</code> (the function saves the
file in the working directory). There are two possibilities:</p>
<ul>
<li>save the object in a single file with the column <strong>pa</strong>
indicating if the location is a presence (1) or an absence/background
(0) site</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/swd2csv.html">swd2csv</a></span><span class="op">(</span><span class="va">data</span>, </span>
<span>        file_name <span class="op">=</span> <span class="st">"data.csv"</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>save the object in two separate files: one for the presence and the
other for the absence/background locations</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/swd2csv.html">swd2csv</a></span><span class="op">(</span><span class="va">data</span>, </span>
<span>        file_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"presence.csv"</span>, <span class="st">"background.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="train-a-model">Train a model<a class="anchor" aria-label="anchor" href="#train-a-model"></a>
</h2>
<p><code>SDMtune</code> supports four methods for model training:</p>
<ul>
<li>Artificial Neural Networks <strong>ANN</strong>, using the
<code>nnet</code> package <span class="citation">(Venables and Ripley
2002)</span>;</li>
<li>Boosted Regression Trees <strong>BRT</strong>, using the
<code>gbm</code> package <span class="citation">(Greenwell et al.
2019)</span>;</li>
<li>Maximum Entropy with two implementations:
<ul>
<li>
<strong>Maxent</strong> using the <code>dismo</code> package <span class="citation">(Hijmans et al. 2017)</span>;</li>
<li>
<strong>Maxnet</strong> using the <code>maxnet</code> package <span class="citation">(Phillips 2017)</span>;</li>
</ul>
</li>
<li>Random Forest <strong>RF</strong>, using the
<code>randomForest</code> package <span class="citation">(Liaw and
Wiener 2002)</span>.</li>
</ul>
<p>The code necessary to train a model is the same for all the
implementations. We will show how to train a <strong>Maxent</strong>
model, you can adapt the code for the other methods or check the
<code>presence absence models</code> vignette.</p>
<div class="section level3">
<h3 id="train-a-model-with-default-settings">Train a model with default settings<a class="anchor" aria-label="anchor" href="#train-a-model-with-default-settings"></a>
</h3>
<p>We use the function <code>train</code> to train a
<strong>Maxent</strong> model. We need to provide two arguments:</p>
<ul>
<li>
<code>method</code>: “Maxent” in our case;</li>
<li>
<code>data</code>: the <code>SWD</code> object with the presence and
background locations.</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"Maxent"</span>, </span>
<span>               data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p>The function trains the model using default settings that are:</p>
<ul>
<li>linear, quadratic, product and hinge feature class
combinations;</li>
<li>regularization multiplier equal to 1;</li>
<li>500 algorithm iterations.</li>
</ul>
<p>We will see later how to change the default settings, for the moment
let’s have a look at the <code>model</code> object.</p>
</div>
<div class="section level3">
<h3 id="explore-an-sdmmodel-object">Explore an SDMmodel object<a class="anchor" aria-label="anchor" href="#explore-an-sdmmodel-object"></a>
</h3>
<p>The output of the function <code>train</code> is an object of class
<code>SDMmodel</code>. Let’s print the <code>model</code> object we’ve
just created:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span></span></code></pre></div>
<p>When we print an <code>SDMmodel</code> object we get the following
information:</p>
<ul>
<li>the name of the class;</li>
<li>the method used to train the model;</li>
<li>the name of the species;</li>
<li>the number of presence locations;</li>
<li>the number of absence/background locations;</li>
<li>the model configurations:
<ul>
<li>fc: the feature class combinations;</li>
<li>reg: the regularization multiplier;</li>
<li>iter: the number of iterations;</li>
</ul>
</li>
<li>the environmental variables used to train the model:
<ul>
<li>the name of the continuous environmental variables, if any;</li>
<li>the name of the categorical environmental variables, if any.</li>
</ul>
</li>
</ul>
<p>An <code>SDMmodel</code> object has two slots:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/slot.html" class="external-link">slotNames</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>
<strong>data</strong>: an <code>SWD</code> object with the presence
absence/background locations used to train the model;</li>
<li>
<strong>model</strong>: a <code>Maxent</code> object, in our case,
with all the model configurations.</li>
</ul>
<p>The slot <code>model</code> contains the configurations of the model
plus other information used to make predictions.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/slot.html" class="external-link">slotNames</a></span><span class="op">(</span><span class="va">model</span><span class="op">@</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p>The most important are: <strong>fc</strong>, <strong>reg</strong> and
<strong>iter</strong> that contain the values of the model
configuration.</p>
</div>
<div class="section level3">
<h3 id="train-a-model-changing-the-default-settings">Train a model changing the default settings<a class="anchor" aria-label="anchor" href="#train-a-model-changing-the-default-settings"></a>
</h3>
<p>The function <code><a href="../reference/train.html">train()</a></code> accepts optional arguments that can
be used to change the default model settings. In our previous example we
could have trained the same model using:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"Maxent"</span>, </span>
<span>               data <span class="op">=</span> <span class="va">data</span>, </span>
<span>               fc <span class="op">=</span> <span class="st">"lqph"</span>, </span>
<span>               reg <span class="op">=</span> <span class="fl">1</span>, </span>
<span>               iter <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<p>In the following example we train a model using linear and hinge as
feature class combination, 0.5 as regularization multiplier and 700
iterations:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"Maxent"</span>, </span>
<span>               data <span class="op">=</span> <span class="va">data</span>, </span>
<span>               fc <span class="op">=</span> <span class="st">"lh"</span>, </span>
<span>               reg <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>               iter <span class="op">=</span> <span class="fl">700</span><span class="op">)</span></span></code></pre></div>
<p>By default Maxent models are trained using the arguments
<em>“removeduplicates=false”</em> and
<em>“addsamplestobackground=false”</em>. The user should have the full
control of the data used to train the model, so is expected that
duplicated locations are already removed and that the presence locations
are already included in the background locations, when desired. You can
use the function <code>thinData</code> to remove duplicated locations
and the function <code>addSamplesToBg</code> to add the presence
locations to the background locations.</p>
</div>
</div>
<div class="section level2">
<h2 id="make-prediction">Make prediction<a class="anchor" aria-label="anchor" href="#make-prediction"></a>
</h2>
<p>New locations are predicted with the function <code>predict</code>.
The function takes three main arguments:</p>
<ul>
<li>a trained model given as <code>SDMmodel</code> object;</li>
<li>a new dataset, used to make prediction (can be a
<code>data.frame</code>, an <code>SWD</code> object or a raster
object);</li>
<li>the output type, that for <strong>Maxent</strong> models can be:
<strong>raw</strong>, <strong>logistic</strong> or
<strong>cloglog</strong>.</li>
</ul>
<p>Next we get the prediction for our training locations using the
<strong>cloglog</strong> output type:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, </span>
<span>                data <span class="op">=</span> <span class="va">data</span>, </span>
<span>                type <span class="op">=</span> <span class="st">"cloglog"</span><span class="op">)</span></span></code></pre></div>
<p>The output in this case is a vector containing all the predicted
values for the training locations:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span></code></pre></div>
<p>We can get the prediction only for the presence location with:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">@</span><span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">@</span><span class="va">pa</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, </span>
<span>                data <span class="op">=</span> <span class="va">p</span>, </span>
<span>                type <span class="op">=</span> <span class="st">"cloglog"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span></code></pre></div>
<p>For models trained with the <strong>Maxent</strong> method, the
function performs the prediction in R without calling the MaxEnt Java
software. This results in a faster computation for large datasets and
might result in a slightly different output compared to the Java
software.</p>
<div class="section level3">
<h3 id="create-a-distribution-map">Create a distribution map<a class="anchor" aria-label="anchor" href="#create-a-distribution-map"></a>
</h3>
<p>We can use the same function to create a distribution map starting
from the <code>predictors</code> raster object:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, </span>
<span>               data <span class="op">=</span> <span class="va">predictors</span>, </span>
<span>               type <span class="op">=</span> <span class="st">"cloglog"</span><span class="op">)</span></span></code></pre></div>
<p>In this case the output is a raster object:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map</span></span></code></pre></div>
<p>The map can be saved in a file directly when running the prediction,
we just have to pass additional arguments to the <code>predict</code>
function. In the next example we save the map in a file called
“<strong>my_file</strong>” in the <strong>GeoTIFF</strong> format:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, </span>
<span>               data <span class="op">=</span> <span class="va">predictors</span>, </span>
<span>               type <span class="op">=</span> <span class="st">"cloglog"</span>, </span>
<span>               file <span class="op">=</span> <span class="st">"my_map"</span>,</span>
<span>               format <span class="op">=</span> <span class="st">"GTiff"</span><span class="op">)</span></span></code></pre></div>
<p>The function <code>predict</code> has other arguments useful when
predicting large datasets:</p>
<ul>
<li>
<strong>progress</strong>: can be set to <code>"text"</code> to
visualize a progress bar;</li>
<li>
<strong>extent</strong>: can be passed to reduce the prediction to
the given extent.</li>
</ul>
<p>In the next example we restrict the prediction to Chile and plot the
prediction:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First create the extent that surrounds Chile</span></span>
<span><span class="va">e</span> <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">77</span>, <span class="op">-</span><span class="fl">60</span>, <span class="op">-</span><span class="fl">56</span>, <span class="op">-</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Now use the extent to make the prediction</span></span>
<span><span class="va">map_e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, </span>
<span>                 data <span class="op">=</span> <span class="va">predictors</span>, </span>
<span>                 type <span class="op">=</span> <span class="st">"cloglog"</span>, </span>
<span>                 extent <span class="op">=</span> <span class="va">e</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plot-a-distribution-map">Plot a distribution map<a class="anchor" aria-label="anchor" href="#plot-a-distribution-map"></a>
</h3>
<p>To plot the distribution map we can use the function
<code>plotPred</code>:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotPred.html">plotPred</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span></span></code></pre></div>
<p>The function <code>plotPred</code> plots a map with a color ramp
similar to the one used by the MaxEnt Java software. We can pass
additional arguments to customize the map. In the next example we
provide a custom color ramp and we add a title to the legend:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotPred.html">plotPred</a></span><span class="op">(</span><span class="va">map</span>, </span>
<span>         lt <span class="op">=</span> <span class="st">"Habitat\nsuitability"</span>,</span>
<span>         colorramp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#2c7bb6"</span>, <span class="st">"#abd9e9"</span>, <span class="st">"#ffffbf"</span>, <span class="st">"#fdae61"</span>, <span class="st">"#d7191c"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plot-a-presenceabsence-map">Plot a presence/absence map<a class="anchor" aria-label="anchor" href="#plot-a-presenceabsence-map"></a>
</h3>
<p>To plot a presence/absence map we need a threshold value that splits
the prediction in presence and absence values. The function
<code>thresholds</code> returns some commonly used threshold values
starting from an <code>SDMmodel</code> object. In the next example we
print the threshold values using the type <code>"cloglog"</code>:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ths</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/thresholds.html">thresholds</a></span><span class="op">(</span><span class="va">model</span>, </span>
<span>                  type <span class="op">=</span> <span class="st">"cloglog"</span><span class="op">)</span></span>
<span><span class="va">ths</span></span></code></pre></div>
<p>For example we want to create a presence/absence map using the
threshold that maximize the training sensitivity plus specificity. We
use the function <code>plotPA</code> passing the threshold value as
argument:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotPA.html">plotPA</a></span><span class="op">(</span><span class="va">map</span>, </span>
<span>       th <span class="op">=</span> <span class="va">ths</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>We can also save the map in a file with the following code:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotPA.html">plotPA</a></span><span class="op">(</span><span class="va">map</span>, </span>
<span>       th <span class="op">=</span> <span class="va">ths</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span>, </span>
<span>       filename <span class="op">=</span> <span class="st">"my_pa_map"</span>, </span>
<span>       format <span class="op">=</span> <span class="st">"GTiff"</span><span class="op">)</span></span></code></pre></div>
<p>Both functions <code>plotPred</code> and <code>plotPA</code> have the
argument <code>hr</code>to plot the the map with high resolution, useful
when the map is used in a scientific publication.</p>
</div>
</div>
<div class="section level2">
<h2 id="evaluate-a-model">Evaluate a model<a class="anchor" aria-label="anchor" href="#evaluate-a-model"></a>
</h2>
<p><code>SDMtune</code> implements three evaluation metrics:</p>
<ul>
<li>AUC: Area Under the ROC curve <span class="citation">(Fielding and
Bell 1997)</span>
</li>
<li>TSS: True Skill Statistic <span class="citation">(Allouche, Tsoar,
and Kadmon 2006)</span>
</li>
<li>AICc: Akaike Information Criterion corrected for small sample size
<span class="citation">(Warren and Seifert 2011)</span>
</li>
</ul>
<p>We will compute the value of the metrics on the training dataset.</p>
<div class="section level3">
<h3 id="auc">AUC<a class="anchor" aria-label="anchor" href="#auc"></a>
</h3>
<p>The AUC can be calculated using the function <code>auc</code>:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/auc.html">auc</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p>We can also plot the ROC curve using the function
<code>plotROC</code>:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotROC.html">plotROC</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="tss">TSS<a class="anchor" aria-label="anchor" href="#tss"></a>
</h3>
<p>The TSS is computed with the function <code>tss</code>:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tss.html">tss</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="aicc">AICc<a class="anchor" aria-label="anchor" href="#aicc"></a>
</h3>
<p>For the AICc we use the function <code>aicc</code>. In this case we
need to pass to the <code>env</code> argument the
<code>predictors</code> raster object:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/aicc.html">aicc</a></span><span class="op">(</span><span class="va">model</span>, </span>
<span>     env <span class="op">=</span> <span class="va">predictors</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="training-and-testing">Training and testing<a class="anchor" aria-label="anchor" href="#training-and-testing"></a>
</h3>
<p>It’s always a good practice to split the species locations into two
parts and use one part to train the model and the remaining part to
evaluate it. We can use the <code>trainValTest</code> function for this
purpose. Let’s say we want to use 80% of the species locations to train
our model and 20% as testing dataset to evaluate it:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lib/zeallot" class="external-link">zeallot</a></span><span class="op">)</span>  <span class="co"># For unpacking assignment</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">train</span>, <span class="va">test</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/zeallot/man/operator.html" class="external-link">%&lt;-%</a></span> <span class="fu"><a href="../reference/trainValTest.html">trainValTest</a></span><span class="op">(</span><span class="va">data</span>, </span>
<span>                                 test <span class="op">=</span> <span class="fl">0.2</span>, </span>
<span>                                 only_presence <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 seed <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span></code></pre></div>
<p>Now we train the model using the <code>train</code> dataset:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span><span class="st">"Maxent"</span>, </span>
<span>               data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span></code></pre></div>
<p>The <code>only_presence</code> argument is used to split only the
presence and not the background locations. We can now evaluate the model
using the testing dataset that has not been used to train the model:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/auc.html">auc</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/auc.html">auc</a></span><span class="op">(</span><span class="va">model</span>, test <span class="op">=</span> <span class="va">test</span><span class="op">)</span></span></code></pre></div>
<p>We can plot the ROC curve for both, training and testing datasets,
with:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotROC.html">plotROC</a></span><span class="op">(</span><span class="va">model</span>, test <span class="op">=</span> <span class="va">test</span><span class="op">)</span></span></code></pre></div>
<p>This approach is valid when we have a large dataset. In our case,
with only few observations, the evaluation depends strongly on how we
split our presence locations. Let’s run a small experiment in which we
perform different train/test splits and we compute the AUC:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create an empty data.frame</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fl">10</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"seed"</span>, <span class="st">"trainAUC"</span>, <span class="st">"testAUC"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create 10 different random seeds</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span></span>
<span><span class="va">seeds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Loop through the seeds</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">seeds</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Make the train/test split</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">train</span>, <span class="va">test</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/zeallot/man/operator.html" class="external-link">%&lt;-%</a></span> <span class="fu"><a href="../reference/trainValTest.html">trainValTest</a></span><span class="op">(</span><span class="va">data</span>, </span>
<span>                                   test <span class="op">=</span> <span class="fl">0.2</span>, </span>
<span>                                   seed <span class="op">=</span> <span class="va">seeds</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>                                   only_presence <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># train the model</span></span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span><span class="st">"Maxent"</span>, data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Populate the output data.frame</span></span>
<span>  <span class="va">output</span><span class="op">[</span><span class="va">i</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">seeds</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">output</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/auc.html">auc</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">output</span><span class="op">[</span><span class="va">i</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/auc.html">auc</a></span><span class="op">(</span><span class="va">m</span>, test <span class="op">=</span> <span class="va">test</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Print the output</span></span>
<span><span class="va">output</span></span>
<span><span class="co"># compute the range of the testing AUC</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">output</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>The testing AUC varies for the different train/test partitions. When
we have to deal with a small dataset a better approach is the cross
validation.</p>
</div>
<div class="section level3">
<h3 id="cross-validation">Cross validation<a class="anchor" aria-label="anchor" href="#cross-validation"></a>
</h3>
<p>To perform a cross validation in <strong>SDMtune</strong> we have to
pass the <code>fold</code> argument to the <code>train</code> function.
First we have to create the folds. There are several way to create them,
here we explain how to make a random partition of 4 folds using the
function <code>randomFolds</code>:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">folds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/randomFolds.html">randomFolds</a></span><span class="op">(</span><span class="va">data</span>, </span>
<span>                     k <span class="op">=</span> <span class="fl">4</span>, </span>
<span>                     only_presence <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                     seed <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span></code></pre></div>
<p>The output of the function is a list containing two matrices, the
first for the training and the second for the testing locations. Each
column of one matrix represents a fold with <code>TRUE</code> for the
locations included in and <code>FALSE</code> excluded from the
partition.</p>
<p>Let’s perform a 4 fold cross validation using the
<strong>Maxent</strong> method (note that we use the full dataset):</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cv_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span><span class="st">"Maxent"</span>, </span>
<span>                  data <span class="op">=</span> <span class="va">data</span>, </span>
<span>                  folds <span class="op">=</span> <span class="va">folds</span><span class="op">)</span></span>
<span><span class="va">cv_model</span></span></code></pre></div>
<p>The output in this case is an <code>SDMmodelCV</code> object. It
contains the four trained models in the <code>models</code> slot and the
fold partitions in the <code>folds</code> slot. We can compute the AUC
of a <code>SDMmodelCV</code> object using:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/auc.html">auc</a></span><span class="op">(</span><span class="va">cv_model</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/auc.html">auc</a></span><span class="op">(</span><span class="va">cv_model</span>, test <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>this returns the AUC value averaged across the four different
models.</p>
</div>
<div class="section level3">
<h3 id="spatial-cross-validation">Spatial Cross Validation<a class="anchor" aria-label="anchor" href="#spatial-cross-validation"></a>
</h3>
<p>The <code><a href="../reference/train.html">train()</a></code> function accepts folds created with two
other packages:</p>
<ul>
<li>
<code>ENMeval</code> <span class="citation">(Muscarella et al.
2014)</span>
</li>
<li>
<code>blockCV</code> <span class="citation">(Valavi et al.
2019)</span>
</li>
</ul>
<p>The function will convert internally the created folds into the
correct format for <code>SDMtune</code>. These packages have specific
function to create folds partitions that are spatially or
environmentally independent.</p>
<p>Block partition using the <code>ENMeval</code> package:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jamiemkass.github.io/ENMeval/" class="external-link">ENMeval</a></span><span class="op">)</span></span>
<span><span class="va">block_folds</span> <span class="op">&lt;-</span> <span class="fu">get.block</span><span class="op">(</span>occ <span class="op">=</span> <span class="va">data</span><span class="op">@</span><span class="va">coords</span><span class="op">[</span><span class="va">data</span><span class="op">@</span><span class="va">pa</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span>,</span>
<span>                         bg.coords <span class="op">=</span> <span class="va">data</span><span class="op">@</span><span class="va">coords</span><span class="op">[</span><span class="va">data</span><span class="op">@</span><span class="va">pa</span> <span class="op">==</span> <span class="fl">0</span>, <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"Maxent"</span>, </span>
<span>               data <span class="op">=</span> <span class="va">data</span>, </span>
<span>               fc <span class="op">=</span> <span class="st">"l"</span>, </span>
<span>               reg <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>               folds <span class="op">=</span> <span class="va">block_folds</span><span class="op">)</span></span></code></pre></div>
<p>Checkerboard1 partition using the <code>ENMeval</code> package:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cb_folds</span> <span class="op">&lt;-</span> <span class="fu">get.checkerboard1</span><span class="op">(</span>occ <span class="op">=</span> <span class="va">data</span><span class="op">@</span><span class="va">coords</span><span class="op">[</span><span class="va">data</span><span class="op">@</span><span class="va">pa</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span>,</span>
<span>                              env <span class="op">=</span> <span class="va">predictors</span>,</span>
<span>                              bg.coords <span class="op">=</span> <span class="va">data</span><span class="op">@</span><span class="va">coords</span><span class="op">[</span><span class="va">data</span><span class="op">@</span><span class="va">pa</span> <span class="op">==</span> <span class="fl">0</span>, <span class="op">]</span>,</span>
<span>                              aggregation.factor <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"Maxent"</span>, </span>
<span>               data <span class="op">=</span> <span class="va">data</span>, </span>
<span>               fc <span class="op">=</span> <span class="st">"l"</span>, </span>
<span>               reg <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>               folds <span class="op">=</span> <span class="va">cb_folds</span><span class="op">)</span></span></code></pre></div>
<p>Environmental block using the package <code>blockCV</code>:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rvalavi/blockCV" class="external-link">blockCV</a></span><span class="op">)</span></span>
<span><span class="co"># Create sf object</span></span>
<span><span class="va">sf_df</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu">st_as_sf</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">data</span><span class="op">@</span><span class="va">coords</span>, pa <span class="op">=</span> <span class="va">data</span><span class="op">@</span><span class="va">pa</span><span class="op">)</span>,</span>
<span>                      coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>,</span>
<span>                      crs <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">predictors</span>,</span>
<span>                                       proj <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Spatial blocks</span></span>
<span><span class="va">spatial_folds</span> <span class="op">&lt;-</span> <span class="fu">cv_spatial</span><span class="op">(</span>x <span class="op">=</span> <span class="va">sf_df</span>,</span>
<span>                            column <span class="op">=</span> <span class="st">"pa"</span>,</span>
<span>                            rows_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                            k <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                            hexagon <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                            selection <span class="op">=</span> <span class="st">"systematic"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train.html">train</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"Maxent"</span>, </span>
<span>               data <span class="op">=</span> <span class="va">data</span>, </span>
<span>               fc <span class="op">=</span> <span class="st">"l"</span>, </span>
<span>               reg <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>               folds <span class="op">=</span> <span class="va">spatial_folds</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-ALLOUCHE2006" class="csl-entry">
Allouche, Omri, Asaf Tsoar, and Ronen Kadmon. 2006. <span>“Assessing the
Accuracy of Species Distribution Models: Prevalence, Kappa and the True
Skill Statistic (TSS).”</span> <em>Journal of Applied Ecology</em> 43
(6): 1223–32. https://doi.org/<a href="https://doi.org/10.1111/j.1365-2664.2006.01214.x" class="external-link">https://doi.org/10.1111/j.1365-2664.2006.01214.x</a>.
</div>
<div id="ref-Fielding1997" class="csl-entry">
Fielding, Alan H., and John F. Bell. 1997. <span>“<span class="nocase">A
review of methods for the assessment of prediction errors in
conservation presence/absence models</span>.”</span> <em>Environmental
Conservation</em> 24 (1): 38–49.
</div>
<div id="ref-Greenwell2019" class="csl-entry">
Greenwell, Brandon, Bradley Boehmke, Jay Cunningham, and GBM Developers.
2019. <span>“<span class="nocase">gbm: Generalized Boosted Regression
Models. R package version 2.1.5</span>.”</span>
https://CRAN.R-project.org/package=gbm.
</div>
<div id="ref-Hijmans2005" class="csl-entry">
Hijmans, Robert J., Susan E. Cameron, Juan L. Parra, Peter G. Jones, and
Andy Jarvis. 2005. <span>“Very High Resolution Interpolated Climate
Surfaces for Global Land Areas.”</span> <em>International Journal of
Climatology</em> 25 (15): 1965–78. https://doi.org/<a href="https://doi.org/10.1002/joc.1276" class="external-link">https://doi.org/10.1002/joc.1276</a>.
</div>
<div id="ref-Hijmans2017" class="csl-entry">
Hijmans, Robert J., Steven Phillips, John Leathwick, and Jane Elith.
2017. <span>“<span class="nocase">dismo: Species Distribution Modeling.
R package version 1.1-4</span>.”</span>
https://cran.r-project.org/package=dismo.
</div>
<div id="ref-Liaw2002" class="csl-entry">
Liaw, Andy, and Matthew Wiener. 2002. <span>“<span class="nocase">Classification and Regression by
randomForest</span>.”</span> <em>R News</em> 2 (3): 18–22.
</div>
<div id="ref-Muscarella2014" class="csl-entry">
Muscarella, Robert, Peter J. Galante, Mariano Soley-Guardia, Robert A.
Boria, Jamie M. Kass, María Uriarte, and Robert P. Anderson. 2014.
<span>“ENMeval: An r Package for Conducting Spatially Independent
Evaluations and Estimating Optimal Model Complexity for Maxent
Ecological Niche Models.”</span> <em>Methods in Ecology and
Evolution</em> 5 (11): 1198–1205. https://doi.org/<a href="https://doi.org/10.1111/2041-210X.12261" class="external-link">https://doi.org/10.1111/2041-210X.12261</a>.
</div>
<div id="ref-Olson2001" class="csl-entry">
Olson, David M., Eric Dinerstein, Eric D. Wikramanayake, Neil D.
Burgess, George V. N. Powell, Emma C. Underwood, Jennifer A. D’amico, et
al. 2001. <span>“<span class="nocase">Terrestrial Ecoregions of the
World: A New Map of Life on Earth</span>.”</span> <em>BioScience</em> 51
(11): 933. <a href="https://doi.org/10.1641/0006-3568(2001)051%5B0933:TEOTWA%5D2.0.CO;2" class="external-link">https://doi.org/10.1641/0006-3568(2001)051[0933:TEOTWA]2.0.CO;2</a>.
</div>
<div id="ref-Phillips2017b" class="csl-entry">
Phillips, Steven. 2017. <em><span class="nocase">maxnet: Fitting
’Maxent’ Species Distribution Models with ’glmnet’. R package version
0.1.2</span></em>. https://cran.r-project.org/package=maxnet.
</div>
<div id="ref-Valavi2019" class="csl-entry">
Valavi, Roozbeh, Jane Elith, José J. Lahoz-Monfort, and Gurutzeta
Guillera-Arroita. 2019. <span>“blockCV: An r Package for Generating
Spatially or Environmentally Separated Folds for k-Fold Cross-Validation
of Species Distribution Models.”</span> <em>Methods in Ecology and
Evolution</em> 10 (2): 225–32. https://doi.org/<a href="https://doi.org/10.1111/2041-210X.13107" class="external-link">https://doi.org/10.1111/2041-210X.13107</a>.
</div>
<div id="ref-Venables2002" class="csl-entry">
Venables, W N, and B. D. Ripley. 2002. <em><span class="nocase">Modern
Applied Statistics with S.</span></em> Fourth Edi. New York, NY:
Springer.
</div>
<div id="ref-Warren2011a" class="csl-entry">
Warren, Dan L., and Stephanie N. Seifert. 2011. <span>“Ecological Niche
Modeling in Maxent: The Importance of Model Complexity and the
Performance of Model Selection Criteria.”</span> <em>Ecological
Applications</em> 21 (2): 335–42. https://doi.org/<a href="https://doi.org/10.1890/10-1171.1" class="external-link">https://doi.org/10.1890/10-1171.1</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/sgvignali" class="external-link">Sergio Vignali</a>, <a href="http://www.cb.iee.unibe.ch/about_us/barras_arnaud_gian/index_eng.html" class="external-link">Arnaud Barras</a>, <a href="http://www.cb.iee.unibe.ch/about_us/dr_braunisch_veronika/index_eng.html" class="external-link">Veronika Braunisch</a>, <a href="http://www.cb.iee.unibe.ch/index_eng.html" class="external-link">Conservation Biology - University of Bern</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
